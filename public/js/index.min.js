let neighborhoods,cuisines,map,markers=[],is_map_to_be_loaded=!1,is_append_properties=!navigator.onLine;document.addEventListener("DOMContentLoaded",e=>{lazyLoadImages(),new Promise((e,t)=>{DBHelper.v1LoadData(!0,(t,n)=>{!t&&n||e(!1),e(n)})}).then(e=>new Promise((e,t)=>{DBHelper.processPendingRequests((t,n)=>{e(!0)})})).then(e=>new Promise((e,t)=>{fetchContent(is_append_properties,(t,n)=>{e(!0)})})).catch(e=>{console.log("Error: "+e)})}),fetchContent=((e,t)=>new Promise((t,n)=>{fetchNeighborhoods(e,(e,n)=>{t(!0)})}).then(t=>new Promise((t,n)=>{fetchCuisines(e,(e,n)=>{t(!0)})})).then(e=>(updateRestaurants(),!0)).catch(e=>{console.log("Error: "+e)})),fetchNeighborhoods=((e,t)=>new Promise((t,n)=>{DBHelper.fetchNeighborhoods(e,(e,s)=>{e&&n(!1),t(s)})}).then(e=>{e?(self.neighborhoods=e,fillNeighborhoodsHTML()):console.log("Error: data missing -index-fetchNeighborhoods()"),t(null,e)}).catch(e=>{console.log(e+"-index-fetchNeighborhoods()-catch"),t(e.message,null)})),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=((e,t)=>new Promise((t,n)=>{DBHelper.fetchCuisines(e,(e,s)=>{e&&n(!1),t(s)})}).then(e=>{e&&(self.cuisines=e,fillCuisinesHTML()),t(null,e)}).catch(e=>{console.log(e+"-index-fetchCuisines()-catch"),t(e.message,null)})),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:new google.maps.LatLng(0,0),scrollwheel:!1})}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,s=t.selectedIndex,a=e[n].value,r=t[s].value;new Promise((e,t)=>{DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,r,is_append_properties,(n,s)=>{n&&t(n),e(s)})}).then(e=>{e&&(resetRestaurants(e),fillRestaurantsHTML())}).catch(e=>{console.log(e+"-index-updateRestaurants()-catch")})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",void 0!==self.markers&&"undefined"!=self.markers&&self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{if(!e)return;const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{if(!e)return!1;const t=document.createElement("li"),n=DBHelper.imageUrlForRestaurant(e),s=document.createElement("img");s.className="restaurant-img lazy",s.alt=e.name,n?(img_parts=n.split("/"),s.src=img_parts[0]+"/320/"+img_parts[1],s.setAttribute("data-sizes","auto"),s.setAttribute("data-src",img_parts[0]+"/320/"+img_parts[1]),s.setAttribute("data-srcset",img_parts[0]+"/320/"+img_parts[1]+" 300w,"+img_parts[0]+"/640/"+img_parts[1]+" 600w,"+img_parts[0]+"/1024/"+img_parts[1]+" 1000w,"+img_parts[0]+"/1600/"+img_parts[1]+" 1600w")):s.src="img/placeholder.png",t.append(s);const a=createFavoriteHTML(e),r=document.createElement("h3");r.innerHTML=e.name+"&nbsp;",r.append(a),t.append(r);const o=document.createElement("p");o.innerHTML=e.neighborhood,t.append(o);const i=document.createElement("p");i.innerHTML=e.address,t.append(i);const l=document.createElement("a");return l.innerHTML="View Details",l.href=DBHelper.urlForRestaurant(e),l.setAttribute("role","button"),l.setAttribute("tabindex","0"),l.setAttribute("aria-pressed","false"),l.setAttribute("aria-label",e.name),t.append(l),t}),addMarkersToMap=((e=self.restaurants)=>{if(navigator.onLine){if(!is_map_to_be_loaded){return document.getElementById("map").innerHTML='<img class="lazy" src="/img/google-map.png" alt="Map">',window.onclick=function(e){window.onclick=null,document.getElementById("map").innerHTML="",window.initMap(),updateRestaurants()},void(is_map_to_be_loaded=!0)}if(e){const t=new google.maps.LatLngBounds;new Promise((n,s)=>{e.forEach(e=>{if(e){const n=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(n,"click",()=>{window.location.href=n.url}),t.extend(n.position),self.markers.push(n)}}),n(!0)}).then(()=>{self.map.fitBounds(t)}).catch(e=>{console.log(e+"-index-addMarkersToMap()-catch")})}}});