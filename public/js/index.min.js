let neighborhoods,cuisines,map,markers=[],is_map_to_be_loaded=!1,is_append_properties=!navigator.onLine;document.addEventListener("DOMContentLoaded",e=>{DBHelper.debugObject("","index-DOMContentLoaded()"),lazyLoadImages(),new Promise((e,t)=>{DBHelper.debugObject("","index-DOMContentLoaded()-1-v1LoadData()-call");DBHelper.debugObject(!0,"index-DOMContentLoaded()-load_all_restaurants"),DBHelper.v1LoadData(!0,(t,n)=>{DBHelper.debugObject(t,"index-DOMContentLoaded()-v1LoadData-error"),DBHelper.debugObject(n,"index-DOMContentLoaded()-v1LoadData-result"),!t&&n||e(!1),e(n)})}).then(e=>(DBHelper.debugObject(e,"index-DOMContentLoaded()-2-1-restaurants"),new Promise((e,t)=>{DBHelper.processPendingRequests((t,n)=>{e(!0)})}))).then(e=>(DBHelper.debugObject(e,"index-DOMContentLoaded()-3-1-restaurants"),new Promise((e,t)=>{fetchContent(is_append_properties,(t,n)=>{e(!0)})}))).catch(e=>{console.log("Error: "+e)})}),fetchContent=((e,t)=>new Promise((t,n)=>{fetchNeighborhoods(e,(e,n)=>{t(!0)})}).then(t=>new Promise((t,n)=>{fetchCuisines(e,(e,n)=>{t(!0)})})).then(e=>(updateRestaurants(),!0)).catch(e=>{console.log("Error: "+e)})),fetchNeighborhoods=((e,t)=>new Promise((t,n)=>{DBHelper.fetchNeighborhoods(e,(e,a)=>{e&&n(!1),t(a)})}).then(e=>{e?(self.neighborhoods=e,fillNeighborhoodsHTML()):console.log("Error: data missing -index-fetchNeighborhoods()"),t(null,e)}).catch(e=>{console.log(e+"-index-fetchNeighborhoods()-catch"),t(e.message,null)})),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),fetchCuisines=((e,t)=>new Promise((t,n)=>{DBHelper.fetchCuisines(e,(e,a)=>{e&&n(!1),t(a)})}).then(e=>{e&&(self.cuisines=e,fillCuisinesHTML()),t(null,e)}).catch(e=>{console.log(e+"-index-fetchCuisines()-catch"),t(e.message,null)})),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}),window.initMap=(()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:new google.maps.LatLng(0,0),scrollwheel:!1})}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,a=t.selectedIndex,s=e[n].value,o=t[a].value;new Promise((e,t)=>{DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,o,is_append_properties,(n,a)=>{n&&t(n),e(a)})}).then(e=>{e&&(resetRestaurants(e),fillRestaurantsHTML())}).catch(e=>{console.log(e+"-index-updateRestaurants()-catch")})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",void 0!==self.markers&&"undefined"!=self.markers&&self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{if(!e)return;const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{if(!e)return!1;const t=document.createElement("li"),n=DBHelper.imageUrlForRestaurant(e),a=document.createElement("img");a.className="restaurant-img lazy",a.alt=e.name,n?(img_parts=n.split("/"),a.src=img_parts[0]+"/320/"+img_parts[1],a.setAttribute("data-sizes","auto"),a.setAttribute("data-src",img_parts[0]+"/320/"+img_parts[1]),a.setAttribute("data-srcset",img_parts[0]+"/320/"+img_parts[1]+" 300w,"+img_parts[0]+"/640/"+img_parts[1]+" 600w,"+img_parts[0]+"/1024/"+img_parts[1]+" 1000w,"+img_parts[0]+"/1600/"+img_parts[1]+" 1600w")):a.src="img/placeholder.png",t.append(a);const s=createFavoriteHTML(e),o=document.createElement("h1");o.innerHTML=e.name+"&nbsp;",o.append(s),t.append(o);const r=document.createElement("p");r.innerHTML=e.neighborhood,t.append(r);const i=document.createElement("p");i.innerHTML=e.address,t.append(i);const d=document.createElement("a");return d.innerHTML="View Details",d.href=DBHelper.urlForRestaurant(e),d.setAttribute("role","button"),d.setAttribute("tabindex","0"),d.setAttribute("aria-pressed","false"),d.setAttribute("aria-label",e.name),t.append(d),t}),addMarkersToMap=((e=self.restaurants)=>{if(DBHelper.debugObject(navigator.onLine,"index-addMarkersToMap()-navigator.onLine"),navigator.onLine){if(DBHelper.debugObject(is_map_to_be_loaded,"index-addMarkersToMap()-is_map_to_be_loaded"),!is_map_to_be_loaded){return document.getElementById("map").innerHTML='<img class="lazy" src="/img/google-map.png" alt="Map">',window.onclick=function(e){window.onclick=null,document.getElementById("map").innerHTML="",window.initMap(),updateRestaurants()},void(is_map_to_be_loaded=!0)}if(DBHelper.debugObject(is_map_to_be_loaded,"index-addMarkersToMap()-is_map_to_be_loaded"),DBHelper.debugObject(e,"index-addMarkersToMap()-restaurants"),e){const t=new google.maps.LatLngBounds;new Promise((n,a)=>{e.forEach(e=>{if(e){const n=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(n,"click",()=>{window.location.href=n.url}),t.extend(n.position),self.markers.push(n)}}),n(!0)}).then(()=>{self.map.fitBounds(t)}).catch(e=>{console.log(e+"-index-addMarkersToMap()-catch")})}}});