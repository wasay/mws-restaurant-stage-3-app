let restaurant,reviews,map;function saveNewReview(e,t){const a=document.getElementById("d_name").value,n=document.getElementById("d_rating"),r=n.options[n.selectedIndex].value,s=document.getElementById("d_comments").value,l=(new Date).getTime(),o={id:"",review_id:"",restaurant_id:parseInt(e),name:a,createdAt:l,updatedAt:l,rating:parseInt(r),comments:s};new Promise((e,t)=>{DBHelper.addUpdateReviewById(o,(a,n)=>{a&&t(a),e(n)})}).then(e=>{e?t(null,e):t("Unable to complete request",null)}).catch(e=>{console.log(e+"-restaurant-addReviewModalListener()-catch"),t(e.message,null)})}function formattedUnixTime(e){try{let t,a=(t=Number.isInteger(e)?new Date(e):Date.parse(e)).getFullYear();const n=t.getMonth(),r=t.getDate(),s=new Date;a>s.getFullYear()&&(a=s.getFullYear());const l=t.getHours(),o="0"+t.getMinutes(),d="0"+t.getSeconds();return n+"/"+r+"/"+a+" "+(l+":"+o.substr(-2)+":"+d.substr(-2)).toString()}catch(e){console.log("Error format: "+e)}}function addReviewModalListener(e){const t=document.getElementById("myModal"),a=document.getElementById("modalAddReview");a&&(a.onclick=function(){t.style.display="block"});const n=document.getElementsByClassName("close")[0];n&&(n.onclick=function(){t.style.display="none"});const r=document.getElementsByClassName("review-modal-close")[0];r&&(r.onclick=function(){t.style.display="none"});const s=document.getElementsByClassName("review-modal-submit")[0];s&&(s.onclick=(()=>{s.onclick=null,s.innerHTML="Wait...";const e=getParameterByName("id"),t=getParameterByName("msg");new Promise((t,a)=>{saveNewReview(e,(e,n)=>{e&&a(e),t(n)})}).then(e=>{if(e){let e=window.location;"Review+saved"!==t&&(e+="&msg=Review+saved!"),window.location=e}else alert("Unable to process Review! Please try again later. -el")}).catch(e=>{console.log(e+"-restaurant-addReviewModalListener()-catch"),alert("Unable to process Review! Please try again later. -cx")})})),window.onclick=function(e){e.target==t&&(t.style.display="none")}}DBHelper.debugObject("","restaurant-start /js/restaurant.js"),document.addEventListener("DOMContentLoaded",e=>{DBHelper.debugObject("","restaurant-DOMContentLoaded()"),lazyLoadImages(),new Promise((e,t)=>{DBHelper.debugObject("","restaurant-DOMContentLoaded()-1-v1LoadData()-call");DBHelper.debugObject(!1,"index-DOMContentLoaded()-load_all_restaurants"),DBHelper.v1LoadData(!1,(t,a)=>{DBHelper.debugObject(t,"restaurant-DOMContentLoaded()-v1LoadData-error"),DBHelper.debugObject(a,"restaurant-DOMContentLoaded()-v1LoadData-result"),!t&&a||e(!1),e(a)})}).then(e=>(DBHelper.debugObject(e,"restaurant-DOMContentLoaded()-2-1-restaurants"),new Promise((e,t)=>{DBHelper.processPendingRequests((t,a)=>{e(!0)})}))).catch(e=>{console.log("restaurant-Error: "+e)})}),window.initMap=(()=>{new Promise((e,t)=>{getRestaurantFromURL((a,n)=>{n?(fillBreadcrumb(),self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:new google.maps.LatLng(0,0),scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),e(n)):t(a)})}).then(e=>{e&&addReviewModalListener(e.id)}).catch(e=>{console.log("restaurant-window.initMap-Error: "+e)})}),getRestaurantFromURL=(e=>{if(DBHelper.debugObject("","restaurant-getRestaurantFromURL()"),self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");let a;t?new Promise((e,a)=>{DBHelper.debugObject("","restaurant-getRestaurantFromURL()-getRestaurantById() - call"),DBHelper.getRestaurantById(t,(t,n)=>{DBHelper.debugObject(t,"restaurant-getRestaurantFromURL()-getRestaurantById()-error"),DBHelper.debugObject(n,"restaurant-getRestaurantFromURL()-getRestaurantById()-result"),t&&a(!1),e(n)})}).then(t=>{DBHelper.debugObject(t,"restaurant-getRestaurantFromURL()-restaurant"),t&&(self.restaurant=t,self.restaurant.reviews=t.reviews,self.restaurant.operating_hours=t.operating_hours,DBHelper.debugObject("","restaurant-getRestaurantFromURL()-fillRestaurantHTML() - call"),fillRestaurantHTML(),e(null,t))}).catch(t=>{console.log("restaurant - "+t+" - catch"),e(t.message,null)}):e(a="No restaurant id in URL",null)}),fillRestaurantHTML=((e=self.restaurant)=>{if(!e)return;const t=createFavoriteHTML(e),a=document.getElementById("restaurant-name");a.innerHTML=e.name+"&nbsp;",a.append(t),document.getElementById("restaurant-address").innerHTML=e.address;const n=DBHelper.imageUrlForRestaurant(e),r=document.getElementById("restaurant-img");r.className="restaurant-img lazy",r.alt=e.name,n?(img_parts=n.split("/"),r.src=img_parts[0]+"/320/"+img_parts[1],r.setAttribute("data-sizes","auto"),r.setAttribute("data-src",img_parts[0]+"/320/"+img_parts[1]),r.setAttribute("data-srcset",img_parts[0]+"/320/"+img_parts[1]+" 300w,"+img_parts[0]+"/640/"+img_parts[1]+" 600w,"+img_parts[0]+"/1024/"+img_parts[1]+" 1000w,"+img_parts[0]+"/1600/"+img_parts[1]+" 1600w")):r.src="img/placeholder.png",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let a in e){const n=document.createElement("tr"),r=document.createElement("td");r.innerHTML=a,n.appendChild(r);const s=document.createElement("td");s.innerHTML=e[a],n.appendChild(s),t.appendChild(n)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),a=document.createElement("h2");a.innerHTML="Reviews";const n=document.createElement("a");n.id="modalAddReview",n.className="add-review",n.innerHTML="Add Review",n.setAttribute("role","button"),n.setAttribute("tabindex","0"),n.setAttribute("aria-pressed","false"),n.setAttribute("aria-label","Add review"),a.appendChild(n),t.appendChild(a);const r=document.createElement("br");if(t.appendChild(r),e&&0!==e.length){const a=document.getElementById("reviews-list");e&&e.length>0&&e.forEach(e=>{a.appendChild(createReviewHTML(e))}),t.appendChild(a)}else{const e=document.createElement("p");e.innerHTML="No reviews yet!",t.appendChild(e);const a=document.createElement("br");t.appendChild(a)}}),createReviewHTML=(e=>{const t=document.createElement("li"),a=document.createElement("p");a.innerHTML=e.name,t.appendChild(a);const n=formattedUnixTime(e.createdAt),r=document.createElement("p");r.innerHTML=n,r.title=n,t.appendChild(r);const s=document.createElement("p");s.innerHTML=`Rating: ${e.rating}`,t.appendChild(s);const l=document.createElement("p");return l.innerHTML=e.comments,t.appendChild(l),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),a=document.createElement("li");a.innerHTML=e.name,a.setAttribute("aria-label",e.name),a.setAttribute("aria-current","page"),t.appendChild(a)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const a=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null});