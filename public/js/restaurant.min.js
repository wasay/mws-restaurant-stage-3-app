let restaurant,reviews,map;function saveNewReview(e,t){const n=document.getElementById("d_name").value,a=document.getElementById("d_rating"),r=a.options[a.selectedIndex].value,s=document.getElementById("d_comments").value,l=(new Date).getTime(),i={id:"",review_id:"",restaurant_id:parseInt(e),name:n,createdAt:l,updatedAt:l,rating:parseInt(r),comments:s};new Promise((e,t)=>{DBHelper.addUpdateReviewById(i,(n,a)=>{n&&t(n),e(a)})}).then(e=>{e?t(null,e):t(e,null)}).catch(e=>{console.log(e+"-restaurant-addReviewModalListener()-catch"),t(e,null)})}function formattedUnixTime(e){try{let t,n=(t=Number.isInteger(e)?new Date(e):Date.parse(e)).getFullYear();const a=t.getMonth(),r=t.getDate(),s=new Date;n>s.getFullYear()&&(n=s.getFullYear());const l=t.getHours(),i="0"+t.getMinutes(),o="0"+t.getSeconds();return a+"/"+r+"/"+n+" "+(l+":"+i.substr(-2)+":"+o.substr(-2)).toString()}catch(e){console.log("Error format: "+e)}}function addReviewModalListener(e){const t=document.getElementById("myModal"),n=document.getElementById("modalAddReview");n&&(n.onclick=function(){t.style.display="block"});const a=document.getElementsByClassName("close")[0];a&&(a.onclick=function(){t.style.display="none"});const r=document.getElementsByClassName("review-modal-close")[0];r&&(r.onclick=function(){t.style.display="none"});const s=document.getElementsByClassName("review-modal-submit")[0];s&&(s.onclick=(()=>{s.onclick=null,s.innerHTML="Wait...";const e=getParameterByName("id");getParameterByName("msg");new Promise((t,n)=>{saveNewReview(e,(e,a)=>{e&&n(e),t(a)})}).then(e=>{e||console.log("Offline, review will be saved once online.");let t=window.location;window.location=t}).catch(e=>{console.log(e+"-restaurant-addReviewModalListener()-catch");let t=window.location;window.location=t})})),window.onclick=function(e){e.target==t&&(t.style.display="none")}}document.addEventListener("DOMContentLoaded",e=>{lazyLoadImages(),new Promise((e,t)=>{DBHelper.v1LoadData(!1,(t,n)=>{!t&&n||e(!1),e(n)})}).then(e=>new Promise((e,t)=>{DBHelper.processPendingRequests((t,n)=>{e(!0)})})).catch(e=>{console.log("restaurant-Error: "+e)})}),window.initMap=(()=>{new Promise((e,t)=>{getRestaurantFromURL((n,a)=>{a?(fillBreadcrumb(),self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:new google.maps.LatLng(0,0),scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),e(a)):t(n)})}).then(e=>{e&&addReviewModalListener(e.id)}).catch(e=>{console.log("restaurant-window.initMap-Error: "+e)})}),getRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");let n;t?new Promise((e,n)=>{DBHelper.getRestaurantById(t,(t,a)=>{t&&n(!1),e(a)})}).then(t=>{t&&(self.restaurant=t,self.restaurant.reviews=t.reviews,self.restaurant.operating_hours=t.operating_hours,fillRestaurantHTML(),e(null,t))}).catch(t=>{console.log("restaurant - "+t+" - catch"),e(t.message,null)}):e(n="No restaurant id in URL",null)}),fillRestaurantHTML=((e=self.restaurant)=>{if(!e)return;const t=createFavoriteHTML(e),n=document.getElementById("restaurant-name");n.innerHTML=e.name+"&nbsp;",n.append(t),document.getElementById("restaurant-address").innerHTML=e.address;const a=DBHelper.imageUrlForRestaurant(e),r=document.getElementById("restaurant-img");r.className="restaurant-img lazy",r.alt=e.name,a?(img_parts=a.split("/"),r.src=img_parts[0]+"/320/"+img_parts[1],r.setAttribute("data-sizes","auto"),r.setAttribute("data-src",img_parts[0]+"/320/"+img_parts[1]),r.setAttribute("data-srcset",img_parts[0]+"/320/"+img_parts[1]+" 300w,"+img_parts[0]+"/640/"+img_parts[1]+" 600w,"+img_parts[0]+"/1024/"+img_parts[1]+" 1000w,"+img_parts[0]+"/1600/"+img_parts[1]+" 1600w")):r.src="img/placeholder.png",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("td");r.innerHTML=n,r.setAttribute("data-th",n),a.appendChild(r);const s=document.createElement("td");s.innerHTML=e[n],a.appendChild(s),t.appendChild(a)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h4");n.innerHTML="Reviews";const a=document.createElement("a");a.id="modalAddReview",a.className="add-review",a.innerHTML="Add Review",a.setAttribute("role","button"),a.setAttribute("tabindex","0"),a.setAttribute("aria-pressed","false"),a.setAttribute("aria-label","Add review"),n.appendChild(a),t.appendChild(n);const r=document.createElement("br");if(t.appendChild(r),e&&0!==e.length){const n=document.getElementById("reviews-list");e&&e.length>0&&e.forEach(e=>{n.appendChild(createReviewHTML(e))}),t.appendChild(n)}else{const e=document.createElement("p");e.innerHTML="No reviews yet!",t.appendChild(e);const n=document.createElement("br");t.appendChild(n)}}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const a=formattedUnixTime(e.createdAt),r=document.createElement("p");r.innerHTML=a,r.title=a,t.appendChild(r);const s=document.createElement("p");s.innerHTML=`Rating: ${e.rating}`,t.appendChild(s);const l=document.createElement("p");return l.innerHTML=e.comments,t.appendChild(l),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-label",e.name),n.setAttribute("aria-current","page"),t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});