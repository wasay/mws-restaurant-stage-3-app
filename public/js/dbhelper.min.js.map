{"version":3,"names":[],"mappings":"","sources":["dbhelper.min.js"],"sourcesContent":["// js/dbhelper.js\n\n// import idb from \"idb\";\nif (debug) console.log('start /lib/dbhelper.js');\n\nconst appPrefix = 'mws-restaurant-stage-3';\nconst dbName = 'topRestaurants5';\nconst dbVersion = 5;\n\nconst staticCacheName = appPrefix + '-v9';\nconst contentImgsCache = appPrefix + '-content-imgs';\n\nconst allCaches = [staticCacheName, contentImgsCache];\nlet addV1Data = false;\nif (debug) console.log('dbhelper-addV1Data=' + addV1Data);\n\n// https://github.com/jakearchibald/idb\n// https://developers.google.com/web/ilt/pwa/lab-indexeddb\n// https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore\nif (debug) console.log('dbhelper-dbName=' + dbName);\nif (debug) console.log('dbhelper-dbVersion=' + dbVersion);\nconst dbPromise = idb.open(dbName, dbVersion, function (upgradeDb) {\n    if (debug) console.log('dbhelper-upgradeDb.oldVersion=' + upgradeDb.oldVersion);\n\n    switch (upgradeDb.oldVersion) {\n        case 0:\n            let restaurantsObjectStore = upgradeDb.createObjectStore('restaurants', {\n                keyPath: 'id',\n                autoIncrement: true\n            });\n            restaurantsObjectStore.createIndex('id', 'id', { unique: true });\n            restaurantsObjectStore.createIndex('name', 'name', { unique: false });\n            restaurantsObjectStore.createIndex('neighborhood', 'neighborhood', { unique: false });\n            restaurantsObjectStore.createIndex('photograph', 'photograph', { unique: false });\n            restaurantsObjectStore.createIndex('address', 'address', { unique: false });\n            restaurantsObjectStore.createIndex('lat', 'lat', { unique: false });\n            restaurantsObjectStore.createIndex('lng', 'lng', { unique: false });\n            restaurantsObjectStore.createIndex('cuisine_type', 'cuisine_type', { unique: false });\n            restaurantsObjectStore.createIndex('is_favorite', 'is_favorite', { unique: false });\n            restaurantsObjectStore.createIndex('createdAt', 'createdAt', { unique: false });\n            restaurantsObjectStore.createIndex('updatedAt', 'updatedAt', { unique: false });\n            if (debug) console.log('dbhelper-restaurantsObjectStore-done');\n        case 1:\n\n            // autoIncrement example - https://developers.google.com/web/ilt/pwa/working-with-indexeddb\n            const operatingHoursObjectStore = upgradeDb.createObjectStore('operating_hours', {\n                keyPath: 'operating_hour_id',\n                autoIncrement: true\n            });\n            operatingHoursObjectStore.createIndex('operating_hour_id', 'operating_hour_id', { unique: true });\n            operatingHoursObjectStore.createIndex('restaurant_id', 'restaurant_id', { unique: false });\n            operatingHoursObjectStore.createIndex('day', 'day', { unique: false });\n            operatingHoursObjectStore.createIndex('hours', 'hours', { unique: false });\n            operatingHoursObjectStore.createIndex('createdAt', 'createdAt', { unique: false });\n            operatingHoursObjectStore.createIndex('updatedAt', 'updatedAt', { unique: false });\n            if (debug) console.log('dbhelper-operatingHoursObjectStore-done');\n        case 2:\n\n            const reviewsObjectStore = upgradeDb.createObjectStore('reviews', {\n                keyPath: 'review_id',\n                autoIncrement: true\n            });\n            reviewsObjectStore.createIndex('id', 'id', { unique: true });\n            reviewsObjectStore.createIndex('restaurant_id', 'restaurant_id', { unique: false });\n            reviewsObjectStore.createIndex('name', 'name', { unique: false });\n            reviewsObjectStore.createIndex('rating', 'rating', { unique: false });\n            reviewsObjectStore.createIndex('comments', 'comments', { unique: false });\n            reviewsObjectStore.createIndex('createdAt', 'createdAt', { unique: false });\n            reviewsObjectStore.createIndex('updatedAt', 'updatedAt', { unique: false });\n            if (debug) console.log('dbhelper-reviewsObjectStore-done');\n        case 3:\n\n            let pendingObjectStore = upgradeDb.createObjectStore('pending', {\n                keyPath: 'id',\n                autoIncrement: true\n            });\n            pendingObjectStore.createIndex('id', 'id', { unique: true });\n            pendingObjectStore.createIndex('url', 'url', { unique: false });\n            pendingObjectStore.createIndex('method', 'method', { unique: false });\n            pendingObjectStore.createIndex('headers', 'headers', { unique: false });\n            pendingObjectStore.createIndex('body', 'body', { unique: false });\n            if (debug) console.log('dbhelper-pendingObjectStore-done');\n\n            addV1Data = true;\n            if (debug) console.log('dbhelper-version-3-addV1Data=' + addV1Data);\n        case 4:\n            if (debug) console.log('dbhelper-version-4-addV1Data=' + addV1Data);\n    }\n}).catch(error => {\n    // Oops!. Got an error from server.\n    console.log(`Request failed createDB. Returned status of ${error.message}`);\n});\n\ndbPromise.then(db => {\n    if (debug) console.log('dbhelper-dbPromise is set');\n    const dbVersion = db.version;\n    if (debug) console.log('dbhelper-dbVersion=' + dbVersion);\n    return true;\n}).then(db => {\n    if (debug) console.log('dbhelper-addV1Data=' + addV1Data);\n    if (addV1Data) {\n        if (debug) console.log('dbhelper--calling-DBHelper.v1AddRestaurantsData()');\n        return DBHelper.v1AddRestaurantsData(db, (error, result) => {\n            if (error) return false;\n            if (result) return true;\n        });\n    }\n    return true;\n}).then(db => {\n    if (debug) console.log('dbhelper-addV1Data=' + addV1Data);\n    if (addV1Data) {\n        if (debug) console.log('dbhelper--calling-DBHelper.v1AddReviewsData()');\n        return DBHelper.v1AddReviewsData(db, (error, result) => {\n            if (error) return false;\n            if (result) return true;\n        });\n    }\n    return true;\n}).catch(error => {\n    if (debug) console.log('dbhelper-some-error');\n    // Oops!. Got an error from server.\n    error.message = `Request failed load data. Returned status of ${error.message}`;\n    throw error;\n});\n\n/**\r\n * Common database helper functions.\r\n */\nclass DBHelper {\n\n    constructor() {\n        this.restaurants = null;\n        this.reviews = null;\n    }\n\n    static get staticCacheName() {\n        return staticCacheName;\n    }\n\n    static get contentImgsCache() {\n        return contentImgsCache;\n    }\n\n    static get allCaches() {\n        return allCaches;\n    }\n\n    static get dbPromise() {\n        return dbPromise;\n    }\n\n    /**\r\n     * Database URL.\r\n     * Change this to restaurants.json file location on your server.\r\n     */\n    static get DATABASE_URL() {\n        //console.log('dbhelper-DATABASE_URL()');\n\n        const port = 1337;\n        return `http://localhost:${port}`;\n    }\n\n    /**\r\n     * Database URL.\r\n     * Change this to restaurants.json file location on your server.\r\n     */\n    static get DATABASE_URL_RESTAURANTS() {\n        return DBHelper.DATABASE_URL + '/restaurants';\n    }\n\n    /**\r\n     * Database URL.\r\n     * Change this to restaurants.json file location on your server.\r\n     */\n    static get DATABASE_URL_REVIEWS() {\n        return DBHelper.DATABASE_URL + '/reviews';\n    }\n\n    /**\r\n     * Fetch restaurants by a cuisine and a neighborhood with proper error handling.\r\n     */\n    static fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-fetchRestaurantByCuisineAndNeighborhood()');\n        // Fetch all restaurants\n        return DBHelper.getAllRestaurants((error, restaurants) => {\n            if (error || !restaurants) {\n                return callback(error, null);\n            }\n            return restaurants;\n        }).then(restaurants => {\n            if (debug) console.log('dbhelper-fetchRestaurantByCuisineAndNeighborhood()-restaurants=' + restaurants);\n            let results = restaurants;\n\n            if (cuisine != 'all') {\n                // filter by cuisine\n                results = results.filter(r => r.cuisine_type == cuisine);\n            }\n            if (neighborhood != 'all') {\n                // filter by neighborhood\n                results = results.filter(r => r.neighborhood == neighborhood);\n            }\n            if (debug) console.log('dbhelper-fetchRestaurantByCuisineAndNeighborhood()-results=' + results);\n            return callback(null, results);\n        });\n    }\n\n    /**\r\n     * Fetch all neighborhoods with proper error handling.\r\n     */\n    static fetchNeighborhoods(callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-fetchNeighborhoods()');\n        // Fetch all restaurants\n        DBHelper.getAllRestaurants((error, restaurants) => {\n            if (debug) console.log('-----------------------------------');\n            if (debug) console.log('dbhelper-fetchNeighborhoods()-getAllRestaurants()-error=' + error);\n            if (debug) console.log('dbhelper-fetchNeighborhoods()-getAllRestaurants()-restaurants=' + restaurants);\n            if (error) return callback(error, null);\n            if (!restaurants) return callback('Restaurants does not exist', null);\n            return restaurants;\n        }).then(restaurants => {\n            // Get all neighborhoods from all restaurants\n            const neighborhoods = restaurants.map((v, i) => restaurants[i].neighborhood);\n            // Remove duplicates from neighborhoods\n            const uniqueNeighborhoods = neighborhoods.filter((v, i) => neighborhoods.indexOf(v) == i);\n            return callback(null, uniqueNeighborhoods);\n        });\n    }\n\n    /**\r\n     * Fetch all cuisines with proper error handling.\r\n     */\n    static fetchCuisines(callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-fetchCuisines()');\n\n        // get all restaurants\n        DBHelper.getAllRestaurants((error, restaurants) => {\n            if (debug) console.log('-----------------------------------');\n            if (debug) console.log('dbhelper-fetchCuisines()-getAllRestaurants()-error=' + error);\n            if (debug) console.log('dbhelper-fetchCuisines()-getAllRestaurants()-restaurants=' + restaurants);\n            if (error) return callback(error, null);\n            if (!restaurants) return callback('Restaurants does not exist', null);\n            return restaurants;\n        }).then(restaurants => {\n            // Get all cuisines from all restaurants\n            const cuisines = restaurants.map((v, i) => restaurants[i].cuisine_type);\n            // Remove duplicates from cuisines\n            const uniqueCuisines = cuisines.filter((v, i) => cuisines.indexOf(v) == i);\n            return callback(null, uniqueCuisines);\n        });\n    }\n\n    /**\r\n     * Restaurant page URL.\r\n     */\n    static urlForRestaurant(restaurant) {\n        //console.log('dbhelper-urlForRestaurant()');\n        return `./restaurant.html?id=${restaurant.id}`;\n    }\n\n    /**\r\n     * Restaurant image URL.\r\n     */\n    static imageUrlForRestaurant(restaurant) {\n        //console.log('dbhelper-imageUrlForRestaurant()');\n        if (restaurant.photograph) {\n            return `img/${restaurant.photograph}.jpg`;\n        }\n    }\n\n    /**\r\n     * Map marker for a restaurant.\r\n     */\n    static mapMarkerForRestaurant(restaurant, map) {\n        //console.log('dbhelper-mapMarkerForRestaurant()');\n        const marker = new google.maps.Marker({\n            position: restaurant.latlng,\n            title: restaurant.name,\n            url: DBHelper.urlForRestaurant(restaurant),\n            map: map,\n            animation: google.maps.Animation.DROP\n        });\n        return marker;\n    }\n\n    /**\r\n     * get all restaurants.\r\n     */\n    static getAllRestaurants(callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-getAllRestaurants()');\n\n        if (debug) console.log('dbhelper-getAllRestaurants()-this.restaurants=' + this.restaurants);\n\n        let restaurants = this.restaurants;\n        return dbPromise.then(() => {\n            if (debug) console.log('dbhelper-getAllRestaurants()-(!Array.isArray(restaurants) || restaurants.length === 0)=' + (!Array.isArray(restaurants) || restaurants.length === 0));\n            if (!Array.isArray(restaurants) || restaurants.length === 0) {\n                return dbPromise.then(() => {\n                    if (debug) console.log('dbhelper-getAllRestaurants()- calling-DBHelper.getAllIndexDbRestaurants()');\n                    return DBHelper.getAllIndexDbRestaurants((error, restaurants) => {\n                        if (debug) console.log('-----------------------------------');\n                        if (debug) console.log('dbhelper-getAllRestaurants()-getAllIndexDbRestaurants()-error=' + error);\n                        if (debug) console.log('dbhelper-getAllRestaurants()-getAllIndexDbRestaurants()-restaurants=' + restaurants);\n                        if (error) return callback(error.message, null);\n                        return restaurants;\n                    });\n                });\n            }\n        }).then(restaurants => {\n            if (debug) console.log('dbhelper-getAllRestaurants()-then()=' + restaurants);\n            if (debug) console.log('dbhelper-getAllRestaurants()-(!Array.isArray(restaurants) || restaurants.length === 0)=' + (!Array.isArray(restaurants) || restaurants.length === 0));\n            if (!Array.isArray(restaurants) || restaurants.length === 0) {\n                if (debug) console.log('dbhelper-getAllRestaurants()-calling - DBHelper.fetchAllRestaurants()');\n                return DBHelper.fetchAllRestaurants((error, restaurants) => {\n                    if (debug) console.log('-----------------------------------');\n                    if (debug) console.log('dbhelper-getAllRestaurants()-fetchAllRestaurants()-error=' + error);\n                    if (debug) console.log('dbhelper-getAllRestaurants()-fetchAllRestaurants()-result=' + restaurants);\n                    if (error) return callback(error.message, null);\n                    return restaurants;\n                });\n            }\n            if (debug) console.log('dbhelper-getAllRestaurants()-getAllIndexDbRestaurants()-return=' + restaurants);\n            return restaurants;\n        }).then(restaurants => {\n            if (debug) console.log('dbhelper-getAllRestaurants()-restaurants=' + restaurants);\n\n            this.restaurants = restaurants;\n            if (debug) console.log('dbhelper-getAllRestaurants()-this.restaurants-end=' + this.restaurants);\n            return callback(null, this.restaurants);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed. Returned status of ${error.message}`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * Fetch review by ID.\r\n     */\n    static getRestaurantById(restaurant_id, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-getRestaurantById()');\n        if (debug) console.log('dbhelper-getRestaurantById()-restaurant_id=' + restaurant_id);\n\n        let restaurants = this.restaurants;\n        return dbPromise.then(() => {\n            if (!Array.isArray(restaurants) || restaurants.length === 0) {\n                restaurants = DBHelper.getAllRestaurants((error, restaurants) => {\n                    if (debug) console.log('-----------------------------------');\n                    if (debug) console.log('dbhelper-getRestaurantById()-restaurants=' + restaurants);\n                    return restaurants;\n                });\n            }\n            return restaurants;\n        }).then(restaurants => {\n            // if restaurants array exists then use that\n            if (debug) console.log('dbhelper-getRestaurantById()-restaurants=' + restaurants);\n\n            if (!restaurants) {\n                let error_message = `Request failed. Unable to retrieve restaurant by id.`;\n                return callback(error_message, null);\n            }\n\n            // set the this.restaurants variable\n            if (debug) console.log('dbhelper-getRestaurantById()-set restaurants to this.restaurants');\n        }).then(restaurants => {\n            return restaurants.then(restaurants => {\n                const restaurant = restaurants.filter(r => r.id == restaurant_id);\n                return callback(null, restaurant);\n            }).catch(error => {\n                // Oops!. Got an error from server.\n                error.message = `Request failed. Returned status of ${error.message}`;\n                return callback(error.message, null);\n            });\n        });\n    }\n\n    /**\r\n     * Fetch all reviews.\r\n     */\n    static getAllIndexDbRestaurants(callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-getAllIndexDbRestaurants()');\n\n        return dbPromise.then(function (db) {\n            const txRestaurants = db.transaction('restaurants', 'readonly');\n            let restaurantsStore = txRestaurants.objectStore('restaurants');\n            return restaurantsStore.getAll();\n        }).then(restaurants_list => {\n            if (debug) console.log('dbhelper-getAllIndexDbRestaurants()-restaurants_list=' + restaurants_list);\n            if (!restaurants_list) return restaurants_list;\n\n            let restaurants = [];\n            for (const restaurant in restaurants_list) {\n                if (debug) console.log('dbhelper-getAllIndexDbRestaurants()-restaurant=' + restaurant);\n                if (debug) console.log('dbhelper-getAllIndexDbRestaurants()-restaurant.id=' + restaurant.id);\n                let rItem = DBHelper.getIndexDbRestaurantById(restaurant.id, (error, result) => {\n                    if (debug) console.log('-----------------------------------');\n                    if (debug) console.log('dbhelper-getAllIndexDbRestaurants()-result' + result);\n                    return result;\n                });\n                restaurants.push(rItem);\n            }\n            return restaurants;\n        }).then(restaurants => {\n            return callback(null, restaurants);\n        });\n    }\n\n    /**\r\n     * Fetch review by ID.\r\n     */\n    static getIndexDbRestaurantById(restaurant_id, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-getIndexDbRestaurantById()');\n        if (debug) console.log('dbhelper-getIndexDbRestaurantById()-restaurant_id=' + restaurant_id);\n\n        if (!restaurant_id) {\n            let error_message = `Request failed. Missing restaurant id`;\n            return callback(error_message, null);\n        }\n\n        dbPromise.then(function (db) {\n            if (debug) console.log('dbhelper-getIndexDbRestaurantById()-dbPromise');\n\n            const txRestaurants = db.transaction('restaurants', 'readonly');\n            if (debug) console.log('dbhelper-getIndexDbRestaurantById()-txRestaurants=' + txRestaurants);\n\n            let restaurantsStore = txRestaurants.objectStore('restaurants');\n            if (debug) console.log('dbhelper-getIndexDbRestaurantById()-restaurantsStore=' + restaurantsStore);\n\n            const restaurant = restaurantsStore.getAll('restaurant_id', restaurant_id);\n            if (debug) console.log('dbhelper-getIndexDbRestaurantById()-restaurant=' + restaurant);\n\n            return restaurant;\n        }).then(function (db, restaurant) {\n            if (!restaurant) {\n                return [];\n            }\n\n            let restaurantsArr = [];\n            let item = {\n                \"id\": restaurant.id,\n                \"name\": restaurant.name,\n                \"neighborhood\": restaurant.neighborhood,\n                \"photograph\": restaurant.photograph,\n                \"address\": restaurant.address,\n                \"latlng\": {\n                    \"lat\": restaurant.latlng.lat,\n                    \"lng\": restaurant.latlng.lat\n                },\n                \"cuisine_type\": restaurant.cuisine_type\n            };\n\n            const txOperatingHours = db.transaction('operating_hours', 'readonly');\n            let operatingHoursStore = txOperatingHours.objectStore('operating_hours');\n            const operating_hours_list = operatingHoursStore.getAll(['restaurant_id', restaurant.id]);\n            let operating_hours = [];\n            for (const indx in operating_hours_list) {\n                operating_hours[indx] = [operating_hours_list[indx]];\n            }\n            item[\"operating_hours\"] = operating_hours;\n\n            const txReviews = db.transaction('reviews', 'readonly');\n            let reviewsStore = txReviews.objectStore('reviews');\n            const review_list = reviewsStore.getAll('restaurant_id', restaurant.id);\n            let reviews = [];\n            for (const review in review_list) {\n                const rItem = {\n                    \"name\": review.name,\n                    \"date\": review.date,\n                    \"rating\": review.rating,\n                    \"comments\": review.comments\n                };\n                reviews.push(rItem);\n            }\n            item[\"reviews\"] = reviews;\n\n            restaurantsArr.push(item);\n\n            if (debug) console.log('dbhelper-restaurantsArr=' + restaurantsArr);\n            return restaurantsArr;\n        }).then(restaurant => callback(null, restaurant));\n    }\n\n    /**\r\n     * Fetch all restaurants\r\n     */\n    static fetchAllRestaurants(callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-fetchAllRestaurants()');\n        // fetch all review with proper error handling.\n\n        let requestURL = DBHelper.DATABASE_URL_RESTAURANTS;\n        if (debug) console.log('dbhelper-fetchAllRestaurants()-requestURL=' + requestURL);\n\n        return fetch(requestURL, {\n            headers: { 'Content-Type': 'application/json' }\n        }).then(networkResponse => {\n            if (debug) console.log('dbhelper-fetchAllRestaurants()-networkResponse' + networkResponse);\n            return networkResponse;\n        }).then(response => response.json()).then(jsonData => {\n            if (debug) console.log('dbhelper-fetchAllRestaurants()-data.length=' + jsonData.length);\n            if (debug) console.log('dbhelper-fetchAllRestaurants()-data=' + jsonData);\n            return callback(null, jsonData);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed. Returned status of ${error.message} - dbhelper-fetchAllRestaurants()`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * Fetch a restaurant by its restaurant ID.\r\n     */\n    static fetchRestaurantById(restaurant_id, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-fetchRestaurantById()');\n        if (debug) console.log('dbhelper-fetchRestaurantById()-restaurant_id=' + restaurant_id);\n        // fetch all restaurant with proper error handling.\n\n        let requestURL = DBHelper.DATABASE_URL_RESTAURANTS + '/' + restaurant_id;\n        if (debug) console.log('dbhelper-fetchRestaurantById()-requestURL=' + requestURL);\n\n        return fetch(requestURL).then(response => {\n            return response.json();\n        }).then(restaurant => {\n\n            // add or update restaurant in cache\n            if (debug) console.log('dbhelper-fetchRestaurantById()-calling-DBHelper.addUpdateLocalRestaurantById()');\n            DBHelper.addUpdateLocalRestaurantById(restaurant, (error, result) => {\n                if (debug) console.log('dbhelper-fetchRestaurantById()-error=' + error);\n                if (debug) console.log('dbhelper-fetchRestaurantById()-result=' + result);\n            });\n\n            if (debug) console.log('dbhelper-fetchRestaurantById()-calling-DBHelper.addUpdateCacheRestaurantById()');\n            DBHelper.addUpdateCacheRestaurantById(restaurant, (error, result) => {\n                if (debug) console.log('-----------------------------------');\n                if (debug) console.log('dbhelper-fetchRestaurantById()-error=' + error);\n                if (debug) console.log('dbhelper-fetchRestaurantById()-result=' + result);\n            });\n            callback(null, restaurant);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed. Returned status of ${error.message}`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * get all reviews.\r\n     */\n    static getAllReviews(callback) {\n\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-getAllReviews()');\n\n        if (!Array.isArray(this.reviews) || this.reviews.length === 0) {\n            this.reviews = DBHelper.getAllIndexDbReviews((error, reviews) => {\n                return reviews;\n            });\n            if (debug) console.log('dbhelper-getAllReviews()-this.reviews' + this.reviews);\n        }\n\n        if (!Array.isArray(this.reviews) || this.reviews.length === 0) {\n            this.reviews = DBHelper.fetchAllReviews((error, reviews) => {\n                return reviews;\n            });\n            if (debug) console.log('dbhelper-getAllReviews()-this.reviews' + this.reviews);\n        }\n\n        return this.reviews.then(reviews => {\n            return callback(null, reviews);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed. Returned status of ${error.message}`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * Fetch review by ID.\r\n     */\n    static getReviewsByRestaurantId(restaurant_id, callback) {\n\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-getReviewsByRestaurantId()');\n        if (debug) console.log('restaurant_id=' + restaurant_id);\n\n        let reviews = this.reviews;\n        if (!Array.isArray(this.reviews) || this.reviews.length === 0) {\n            reviews = DBHelper.getAllReviews((error, restaurant_reviews) => {\n                return restaurant_reviews;\n            });\n        }\n\n        // if reviews array exists then use that to filter out restaurant specific reviews\n        if (debug) console.log('reviews=' + reviews);\n\n        return reviews.then(reviews => {\n            const restaurant_reviews = reviews.filter(r => r.restaurant_id == restaurant_id);\n            return callback(null, restaurant_reviews);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed-2. Returned status of ${error.message}`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * Fetch review by ID.\r\n     */\n    static getReviewById(restaurant_id, review_id, callback) {\n\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-getReviewById()');\n        if (debug) console.log('restaurant_id=' + restaurant_id);\n        if (debug) console.log('review_id=' + review_id);\n\n        let reviews = this.reviews;\n        if (!Array.isArray(this.reviews) || this.reviews.length === 0) {\n            reviews = DBHelper.getAllReviews((error, restaurant_reviews) => {\n                return restaurant_reviews;\n            });\n        }\n\n        // if reviews array exists then use that to filter out restaurant specific reviews\n        if (debug) console.log('reviews=' + reviews);\n\n        return reviews.then(reviews => {\n            const review = reviews.filter(r => r.id == review_id);\n            return callback(null, review);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed-2. Returned status of ${error.message}`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * Fetch all reviews.\r\n     */\n    static getAllIndexDbReviews(callback) {\n\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-getAllIndexDbReviews()');\n\n        dbPromise.then(function (db) {\n            const txReviews = db.transaction('reviews', 'readonly');\n            let reviewsStore = txReviews.objectStore('reviews');\n            const review_list = reviewsStore.getAll();\n            return callback(null, reviews);\n        });\n    }\n\n    //\n    // /**\n    //  * Fetch review by ID.\n    //  */\n    // static getIndexDbReviewsByRestaurantId(restaurant_id, callback) {\n    //\n    //     if (debug) console.log('-----------------------------------');\n    //     if (debug) console.log('dbhelper-getIndexDbReviewsByRestaurantId()');\n    //     if (debug) console.log('review_id=' + (restaurant_id));\n    //\n    //     dbPromise.then(function (db) {\n    //         const txReviews = db.transaction('reviews', 'readonly');\n    //         let reviewsStore = txReviews.objectStore('reviews');\n    //         const review_list = reviewsStore.getAll('restaurant_id', restaurant.id);\n    //         let reviews = [];\n    //         for (const review in review_list) {\n    //             const rItem = {\n    //                 \"id\": review.id,\n    //                 \"restaurant_id\": review.restaurant_id,\n    //                 \"name\": review.name,\n    //                 \"date\": review.date,\n    //                 \"rating\": review.rating,\n    //                 \"comments\": review.comments,\n    //                 \"createdAt\": review.createdAt,\n    //                 \"updatedAt\": review.updatedAt\n    //             };\n    //             reviews.push(rItem);\n    //         }\n    //         return reviews;\n    //     }).then(reviews => {\n    //         return callback(null, JSON.stringify(reviews));\n    //     })\n    //         .catch(error => {\n    //             // Oops!. Got an error from server.\n    //             error.message = (`Request failed. Returned status of ${error.message}`);\n    //             return callback(error.message, null);\n    //         });\n    // }\n    //\n    // /**\n    //  * Fetch review by ID.\n    //  */\n    // static getIndexDbReviewById(review_id, callback) {\n    //\n    //     if (debug) console.log('-----------------------------------');\n    //     if (debug) console.log('dbhelper-getIndexDbReviewById()');\n    //     if (debug) console.log('review_id=' + (review_id));\n    //\n    //     dbPromise.then(function (db) {\n    //         const txReviews = db.transaction('reviews', 'readonly');\n    //         let reviewsStore = txReviews.objectStore('reviews');\n    //         const review_list = reviewsStore.getAll('review_id', review_id);\n    //         let reviews = [];\n    //         for (const review in review_list) {\n    //             const rItem = {\n    //                 \"id\": review.id,\n    //                 \"restaurant_id\": review.restaurant_id,\n    //                 \"name\": review.name,\n    //                 \"date\": review.date,\n    //                 \"rating\": review.rating,\n    //                 \"comments\": review.comments,\n    //                 \"createdAt\": review.createdAt,\n    //                 \"updatedAt\": review.updatedAt\n    //             };\n    //             reviews.push(rItem);\n    //         }\n    //         return reviews;\n    //     }).then(reviews => {\n    //         return callback(null, JSON.stringify(reviews));\n    //     })\n    //         .catch(error => {\n    //             // Oops!. Got an error from server.\n    //             error.message = (`Request failed. Returned status of ${error.message}`);\n    //             return callback(error.message, null);\n    //         });\n    // }\n\n    /**\r\n     * Fetch all reviews\r\n     */\n    static fetchAllReviews(callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-fetchAllReviews()');\n        // fetch all review with proper error handling.\n\n        if (debug) console.log('call-fetch');\n\n        let requestURL = DBHelper.DATABASE_URL_REVIEWS;\n        if (debug) console.log('requestURL=' + requestURL);\n\n        return fetch(requestURL).then(response => callback(null, response.json())).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed-1. Returned status of ${error.message}`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * Fetch all reviews.\r\n     */\n    static fetchReviewsByRestaurantId(restaurant_id, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-fetchReviews()');\n        if (debug) console.log('restaurant_id=' + restaurant_id);\n\n        if (debug) console.log('call-fetch');\n\n        if (debug) console.log('DBHelper.DATABASE_URL_REVIEWS=' + DBHelper.DATABASE_URL_REVIEWS);\n\n        return fetch(DBHelper.DATABASE_URL_REVIEWS).then(response => {\n            const reviews = response.json();\n            const restaurant_reviews = reviews.filter(r => r.restaurant_id == restaurant_id);\n\n            if (debug) console.log('restaurant_reviews=' + restaurant_reviews);\n            return restaurant_reviews;\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed-1. Returned status of ${error.message}`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * Fetch a reviews by its restaurant ID.\r\n     */\n    static fetchReviewById(review_id, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-fetchReviewById()');\n        if (debug) console.log('review_id=' + review_id);\n        // fetch all review with proper error handling.\n\n        if (debug) console.log('call-fetch');\n\n        let requestURL = DBHelper.DATABASE_URL_REVIEWS + '/' + review_id;\n        if (debug) console.log('requestURL=' + requestURL);\n\n        return fetch(requestURL).then(response => {\n            const review = response.json();\n            // add or update review in cache\n            if (debug) console.log('calling-DBHelper.addUpdateLocalReviewById()');\n            DBHelper.addUpdateLocalReviewById(review, (error, result) => {\n                if (debug) console.log('error=' + error);\n                if (debug) console.log('result=' + result);\n            });\n\n            if (debug) console.log('calling-DBHelper.addUpdateCacheReviewById()');\n            DBHelper.addUpdateCacheReviewById(review, (error, result) => {\n                if (debug) console.log('error=' + error);\n                if (debug) console.log('result=' + result);\n            });\n            callback(null, review);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed-1. Returned status of ${error.message}`;\n            return callback(error.message, null);\n        });\n    }\n\n    /**\r\n     * update a restaurant by its ID.\r\n     */\n    static addUpdateRestaurantById(restaurant, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-addUpdateRestaurantById()');\n\n        if (debug && restaurant) {\n            for (const indx in restaurant) {\n                if (debug) console.log('restaurant[' + indx + ']=' + restaurant[indx]);\n            }\n        }\n\n        let local_error = null;\n        let cache_error = null;\n        let remote_error = null;\n\n        dbPromise.then(() => {\n            DBHelper.addUpdateLocalRestaurantById(restaurant, (error, result) => {\n                local_error = error;\n            });\n        }).then(() => {\n            DBHelper.addUpdateCacheRestaurantById(restaurant, (error, result) => {\n                cache_error = error;\n            });\n        }).then(() => {\n            DBHelper.addUpdateRemoteRestaurantById(restaurant, (error, result) => {\n                remote_error = error;\n            });\n        }).then(() => {\n            if (debug) console.log('local_error=' + local_error);\n            if (debug) console.log('cache_error=' + cache_error);\n            if (debug) console.log('remote_error=' + remote_error);\n\n            if (local_error || cache_error || remote_error) {\n\n                if (debug) console.log('error');\n                return callback(local_error || cache_error || remote_error, null);\n            }\n            return callback(null, restaurant);\n        });\n    }\n\n    /**\r\n     * update a restaurant by its ID.\r\n     */\n    static addUpdateLocalRestaurantById(restaurant, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-addUpdateLocalRestaurantById()');\n\n        return dbPromise.then(function (db) {\n            if (debug) console.log('restaurant-restaurant-start');\n            const txRestaurants = db.transaction('restaurants', 'readwrite');\n            let restaurantsStore = txRestaurants.objectStore('restaurants');\n\n            restaurantsStore.get(restaurant.id).then(function (item) {\n                if (!item) {\n                    const rtNewItem = [{\n                        id: restaurant.id,\n                        name: restaurant.name,\n                        neighborhood: restaurant.neighborhood,\n                        photograph: restaurant.photograph,\n                        address: restaurant.address,\n                        lat: restaurant.latlng.lat,\n                        lng: restaurant.latlng.lng,\n                        cuisine_type: restaurant.cuisine_type,\n                        is_favorite: restaurant.is_favorite,\n                        createdAt: restaurant.createdAt,\n                        updatedAt: restaurant.updatedAt\n                    }];\n                    restaurantsStore.add(rtNewItem[0]);\n                } else {\n                    restaurantsStore.put(restaurant);\n                }\n                txRestaurants.complete;\n\n                callback(null, true);\n            }).catch(error => {\n                // Oops!. Got an error from server.\n                error.message = `Request failed. Returned status of ${error.message}`;\n                callback(error, null);\n            });\n        });\n    }\n\n    /**\r\n     * update a restaurant by its ID.\r\n     */\n    static addUpdateCacheRestaurantById(restaurant, callback) {\n\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-addUpdateCacheRestaurantById()');\n\n        if (debug) console.log('Update cache by deleting and then adding cache');\n        return caches.open(staticCacheName).then(function (cache) {\n            if (debug) console.log('Deleting index file cache');\n            return cache.delete(new Request('/')).then(function () {\n                return cache.delete(new Request('/restaurant.html?id=' + restaurant.id));\n            });\n        }).then(function () {\n            if (debug) console.log('Adding index file cache');\n            return fetch(new Request('/')).then(function () {\n                return fetch(new Request('/restaurant.html?id=' + restaurant.id));\n            });\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed. Returned status of ${error.message}`;\n            callback(error, null);\n        });\n    }\n\n    /**\r\n     * update a restaurant by its ID.\r\n     */\n    static addUpdateRemoteRestaurantById(restaurant, callback) {\n\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-addUpdateRemoteRestaurantById()');\n\n        let requestURL = DBHelper.DATABASE_URL_RESTAURANTS + '/' + restaurant.id;\n        if (debug) console.log('requestURL=' + requestURL);\n\n        const requestMethod = 'PUT';\n        const requestBody = JSON.stringify(restaurant);\n        const requestHeaders = {\n            'Content-Type': 'application/json'\n        };\n\n        return fetch(requestURL, {\n            method: requestMethod, body: requestBody, headers: requestHeaders\n        }).catch(error => {\n\n            if (!navigator.onLine) {\n\n                return dbPromise.then(function (db) {\n\n                    if (debug) console.log('restaurant-pending-start');\n                    const txPending = db.transaction('pending', 'readwrite');\n                    let pendingStore = txPending.objectStore('pending');\n\n                    const pending = {\n                        id: Date.now(),\n                        url: requestURL,\n                        method: requestMethod,\n                        body: requestBody,\n                        headers: requestHeaders\n                    };\n                    pendingStore.put(pending);\n                    txPending.complete;\n                    return true;\n                }).then(result => {\n                    callback(null, result);\n                });\n            } else {\n\n                // Oops!. Got an error from server.\n                error.message = `Request failed. Returned status of ${error.message}`;\n                callback(error, null);\n            }\n        });\n    }\n\n    /**\r\n     * update a review by its ID.\r\n     */\n    static addUpdateReviewById(review, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-addUpdateReviewById()');\n\n        if (debug && review) {\n            for (const indx in review) {\n                if (debug) console.log('review[' + indx + ']=' + review[indx]);\n            }\n        }\n\n        let local_error = null;\n        let cache_error = null;\n        let remote_error = null;\n\n        let idMax = review.id;\n        if (debug) console.log('calling-DBHelper.addUpdateLocalReviewById()');\n        DBHelper.addUpdateLocalReviewById(review, (error, result) => {\n            if (debug) console.log('error=' + error);\n            if (debug) console.log('result=' + result);\n            local_error = error;\n        });\n\n        if (debug) console.log('calling-DBHelper.addUpdateCacheReviewById()');\n        DBHelper.addUpdateCacheReviewById(review, (error, result) => {\n            if (debug) console.log('error=' + error);\n            if (debug) console.log('result=' + result);\n            cache_error = error;\n        });\n\n        if (debug) console.log('calling-DBHelper.addUpdateRemoteReviewById()');\n        DBHelper.addUpdateRemoteReviewById(review, (error, result) => {\n            if (debug) console.log('error=' + error);\n            if (debug) console.log('result=' + result);\n            remote_error = error;\n        });\n\n        const myPromise = new Promise((resolve, reject) => {\n            if (debug) console.log('local_error=' + local_error);\n            if (debug) console.log('cache_error=' + cache_error);\n            if (debug) console.log('remote_error=' + remote_error);\n\n            if (local_error || cache_error || remote_error) {\n\n                if (debug) console.log('error');\n                return callback(local_error || cache_error || remote_error, null);\n            }\n            return callback(null, true);\n        });\n    }\n\n    /**\r\n     * update a review by its ID.\r\n     */\n    static addUpdateLocalReviewById(review, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-addUpdateLocalReviewById()');\n\n        return dbPromise.then(function (db) {\n            if (debug) console.log('review-start');\n            const txReview = db.transaction('reviews', 'readwrite');\n            if (debug) console.log('txReview=' + txReview);\n            let reviewStore = txReview.objectStore('reviews');\n\n            const idIndex = reviewStore.index('id');\n            if (debug) console.log('idIndex=' + idIndex);\n\n            return idIndex.getAllKeys().then(keys => {\n                let idMax = 0;\n                keys.forEach(key => {\n                    console.log('key=' + key);\n                    idMax = key;\n                });\n\n                // increment last key value by 1\n                idMax++;\n                if (debug) console.log('idMax++=' + idMax);\n\n                return idMax;\n            }).then(idMax => {\n                if (debug) {\n                    console.log('idMax.then()=' + idMax);\n                    for (const key in review) {\n                        console.log(key + '=' + review[key]);\n                    }\n                }\n                review.id = idMax;\n                if (debug) {\n                    console.log('updated review.id' + idMax);\n                    for (const key in review) {\n                        console.log(key + '=' + review[key]);\n                    }\n                }\n\n                return reviewStore.get(review.id).then(function (item) {\n                    if (!item) {\n                        if (debug) console.log('add review item');\n                        const rtNewItem = [{\n                            id: idMax,\n                            restaurant_id: parseInt(review.restaurant_id),\n                            name: review.name,\n                            rating: parseInt(review.rating),\n                            comment: review.comment,\n                            updatedAt: review.updatedAt,\n                            createdAt: review.createdAt\n                        }];\n                        reviewStore.add(rtNewItem[0]);\n                        if (debug) console.log('review item added');\n                    } else {\n                        if (debug) console.log('update review item');\n                        reviewStore.put(review);\n                    }\n                    txReview.complete;\n\n                    if (debug) console.log('tx complete - callback');\n                    return callback(null, true);\n                }).catch(error => {\n                    // Oops!. Got an error from server.\n                    error.message = `Request failed. Returned status of ${error.message}`;\n                    callback(error, null);\n                });\n            });\n        });\n    }\n\n    /**\r\n     * update a review by its ID.\r\n     */\n    static addUpdateCacheReviewById(review, callback) {\n\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-addUpdateCacheReviewById()');\n\n        if (debug) console.log('Update cache by deleting and then adding cache');\n        return caches.open(staticCacheName).then(function (cache) {\n            if (debug) console.log('Deleting index file cache');\n            return cache.delete(new Request('/restaurant.html?id=' + review.restaurant_id));\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed. Returned status of ${error.message}`;\n            callback(error, null);\n        });\n    }\n\n    /**\r\n     * update a review by its ID.\r\n     */\n    static addUpdateRemoteReviewById(review, callback) {\n        if (debug) console.log('-----------------------------------');\n        if (debug) console.log('dbhelper-addUpdateRemoteReviewById()');\n\n        if (debug && review) {\n            for (const indx in review) {\n                if (debug) console.log('review[' + indx + ']=' + review[indx]);\n            }\n        }\n\n        let requestURL = DBHelper.DATABASE_URL_REVIEWS;\n        if (debug) console.log('requestURL=' + requestURL);\n\n        if (debug) console.log('review.id.length=' + review.id.length);\n        if (review.id.length > 0) {\n            requestURL += '/' + review.id;\n            if (debug) console.log('requestURL=' + requestURL);\n        }\n\n        const requestMethod = 'POST';\n        const requestBody = JSON.stringify(review);\n        const requestHeaders = {\n            'Content-Type': 'application/json'\n        };\n\n        return fetch(requestURL, {\n            method: requestMethod, body: requestBody, headers: requestHeaders\n        }).then(result => {\n            if (debug) console.log('result=' + result);\n            if (debug) console.log('fetch-navigator.onLine=' + navigator.onLine);\n            if (!navigator.onLine) {\n\n                return dbPromise.then(function (db) {\n\n                    if (debug) console.log('review-pending-start');\n                    const txPending = db.transaction('pending', 'readwrite');\n                    let pendingStore = txPending.objectStore('pending');\n\n                    pendingStore.then(() => {\n                        const pending = {\n                            id: Date.now(),\n                            url: requestURL,\n                            method: requestMethod,\n                            body: requestBody,\n                            headers: requestHeaders\n                        };\n                        pendingStore.put(pending);\n                        txPending.complete;\n                    });\n                });\n            }\n        }).catch(error => {\n            if (debug) console.log('catch-navigator.onLine=' + navigator.onLine);\n            // Oops!. Got an error from server.\n            error.message = `Request failed. Returned status of ${error.message}`;\n            callback(error, null);\n        });\n        // if (debug) console.log('fetchResult=' + (fetchResult));\n        //\n        // if (fetchResult) {\n        //     callback(null, fetchResult);\n        // }\n        // else {\n        //     callback('Review does not exist', null);\n        // }\n    }\n\n    static v1AddRestaurantsData(db, callback) {\n        if (debug) console.log('v1AddRestaurantsData()');\n\n        return fetch(DBHelper.DATABASE_URL_RESTAURANTS).then(response => response.json()).then(function (neighborhoods) {\n            if (debug) console.log('v1AddRestaurantsData()-neighborhoods=' + neighborhoods);\n\n            neighborhoods.forEach(restaurant => {\n\n                // add to database\n                if (debug) console.log('v1AddRestaurantsData()-neighborhoods-each-restaurant=' + restaurant);\n                const txRestaurants = db.transaction('restaurants', 'readwrite');\n                let restaurantsStore = txRestaurants.objectStore('restaurants');\n\n                restaurantsStore.get(restaurant.id).then(function (item) {\n\n                    if (debug) console.log('v1AddRestaurantsData()-neighborhoods-each-restaurant-get');\n                    if (item) return true;\n\n                    //https://developer.mozilla.org/en-US/docs/Web/API/IDBObjectStore\n                    const rtNewItem = [{\n                        id: restaurant.id,\n                        name: restaurant.name,\n                        neighborhood: restaurant.neighborhood,\n                        photograph: restaurant.photograph,\n                        address: restaurant.address,\n                        lat: restaurant.latlng.lat,\n                        lng: restaurant.latlng.lng,\n                        cuisine_type: restaurant.cuisine_type,\n                        is_favorite: restaurant.is_favorite,\n                        createdAt: restaurant.createdAt,\n                        updatedAt: restaurant.updatedAt\n                    }];\n                    restaurantsStore.add(rtNewItem[0]);\n                    txRestaurants.complete;\n                    if (debug) console.log('v1AddRestaurantsData()-neighborhoods-each-restaurant-tx-complete');\n\n                    if (debug) console.log('v1AddRestaurantsData()-neighborhoods-each-restaurant-operating_hours-start');\n                    let operating_hours = restaurant.operating_hours;\n\n                    const txOperatingHours = db.transaction('operating_hours', 'readwrite');\n                    let operatingHoursStore = txOperatingHours.objectStore('operating_hours');\n                    for (const indx in operating_hours) {\n                        if (debug) console.log('v1AddRestaurantsData()-neighborhoods-each-restaurant-operating_hours-indx=' + indx);\n                        if (debug) console.log('v1AddRestaurantsData()-neighborhoods-each-restaurant-operating_hours-value[indx]=' + operating_hours[indx]);\n                        operatingHoursStore.add({\n                            restaurant_id: restaurant.id,\n                            day: indx,\n                            hours: operating_hours[indx],\n                            createdAt: restaurant.createdAt,\n                            updatedAt: restaurant.updatedAt\n                        });\n                    }\n                    txOperatingHours.complete;\n                    if (debug) console.log('v1AddRestaurantsData()-neighborhoods-each-restaurant-operating_hours-tx-complete');\n                });\n            });\n\n            return callback(null, true);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed v1AddRestaurantsData. Returned status of ${error.message}`;\n            return callback(error, null);\n        });\n    }\n\n    static v1AddReviewsData(db, callback) {\n        if (debug) console.log('v1AddReviewsData()');\n\n        const requestUrl = DBHelper.DATABASE_URL_REVIEWS;\n        if (debug) console.log('v1AddReviewsData()-requestUrl=' + requestUrl);\n\n        return fetch(requestUrl).then(response => response.json()).then(function (reviews) {\n\n            if (debug) console.log('v1AddReviewsData()-reviews=' + reviews);\n\n            if (debug) console.log('v1AddReviewsData()-reviews-start');\n            const txReviews = db.transaction('reviews', 'readwrite');\n            let reviewsStore = txReviews.objectStore('reviews');\n\n            for (const rkey in reviews) {\n                if (debug) console.log('rkey=' + rkey);\n                if (debug) console.log('review[rkey]=' + reviews[rkey]);\n                if (debug) console.log('reviews[rkey].id=' + reviews[rkey].id);\n                if (debug) console.log('reviews[rkey].restaurant_id=' + reviews[rkey].restaurant_id);\n                if (debug) console.log('reviews[rkey].name=' + reviews[rkey].name);\n                if (debug) console.log('reviews[rkey].createdAt=' + reviews[rkey].createdAt);\n                if (debug) console.log('reviews[rkey].rating=' + reviews[rkey].rating);\n                if (debug) console.log('reviews[rkey].comments=' + reviews[rkey].comments);\n                reviewsStore.add({\n                    id: reviews[rkey].id,\n                    restaurant_id: reviews[rkey].restaurant_id,\n                    name: reviews[rkey].name,\n                    rating: reviews[rkey].rating,\n                    comments: reviews[rkey].comments,\n                    createdAt: reviews[rkey].createdAt,\n                    updatedAt: reviews[rkey].updatedAt\n                });\n            }\n            txReviews.complete;\n            if (debug) console.log('v1AddReviewsData()-reviews-complete');\n\n            return callback(null, true);\n        }).catch(error => {\n            // Oops!. Got an error from server.\n            error.message = `Request failed v1AddReviewsData. Returned status of ${error.message}`;\n            return callback(error, null);\n        });\n    }\n\n    // example copied from\n    // https://stackoverflow.com/questions/847185/convert-a-unix-timestamp-to-time-in-javascript\n    static formattedUnixTime(unix_timestamp) {\n        const date_now = new Date();\n        // Create a new JavaScript Date object based on the timestamp\n        // multiplied by 1000 so that the argument is in milliseconds, not seconds.\n        const date = new Date(unix_timestamp * 1000);\n        let year = date.getFullYear();\n        const month = date.getMonth();\n        const day = date.getDate();\n\n        if (year > date_now.getFullYear()) {\n            year = date_now.getFullYear();\n        }\n\n        // Hours part from the timestamp\n        const hours = date.getHours();\n        // Minutes part from the timestamp\n        const minutes = \"0\" + date.getMinutes();\n        // Seconds part from the timestamp\n        const seconds = \"0\" + date.getSeconds();\n\n        const part = date.getDate();\n\n        // Will display time in 10:30:23 format\n        return month + '/' + day + '/' + year + ' ' + (hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2)).toString();\n        //return (hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2));\n    }\n\n}\n\nif (debug) console.log('end /lib/dbhelper.js');\n\n// module.exports = DBHelper;\n// window.DBHelper = DBHelper;"],"file":"dbhelper.min.js"}