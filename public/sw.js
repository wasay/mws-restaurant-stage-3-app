function servePhoto(e){DBHelper.debugObject("","sw-servePhoto()");let t=e.url.replace(/^(\d+-?)+\d+$\.jpg$/,"");return caches.open(DBHelper.contentImgsCache).then(function(s){const n=s.match(t);return DBHelper.debugObject(!!n.then(e=>e),"sw-servePhoto()-cacheResponse"),s.match(t).then(function(n){return n||fetch(e).then(function(e){return s.put(t,e.clone()),e}).then(e=>e||caches.match("/img/static/placeholder.png")).catch(e=>(e.message=`Request failed serve request. Returned status of ${e.message}`,caches.match("/img/static/placeholder.png")))})}).catch(e=>{throw e.message=`Request failed serve photo. Returned status of ${e.message}`,e})}function serveRequest(e){DBHelper.debugObject("","sw-serveRequest()");let t=e.url;return DBHelper.debugObject(t,"sw-serveRequest()-storageUrl"),caches.open(staticCacheName).then(function(s){const n=s.match(t);return DBHelper.debugObject(!!n.then(e=>e),"sw-serveRequest()-cacheResponse"),n.then(function(n){return n||fetch(e).then(function(e){return s.put(t,e.clone()),e}).catch(e=>(e.message=`Request failed serve request. Returned status of ${e.message}`,caches.match("/404.html")))})}).catch(e=>{throw e.message=`Request failed. Returned status of ${e.message} - sw-serveRequest()-catch`,DBHelper.debugObject(e,"sw-serveRequest()-catch"),e})}function serveJSON(e){if(DBHelper.debugObject("","sw-serveJSON()"),DBHelper.debugObject(navigator.onLine,"sw-serveJSON()-1-navigator.onLine"),!navigator.onLine){const t=getParameterByName("id",e.url);return DBHelper.debugObject(t,"sw-serveJSON()-1-id"),new Promise((e,s)=>{t?(DBHelper.debugObject("","sw-serveJSON()-2-getRestaurantById()-call"),DBHelper.getRestaurantById(t,(n,r)=>{n&&s(n),e(t,r)})):e(t,!1)}).then((e,t)=>e&&t?t:!e&&new Promise((e,t)=>{DBHelper.debugObject("","sw-serveJSON()-3-getAllRestaurants()-call");const s=!navigator.onLine;DBHelper.getAllRestaurants(s,(s,n)=>{s&&t(s),e(n)})}).then(e=>!!(e&&e.length>0)&&e)).then(e=>e?JSON.stringify(e):JSON.stringify([])).catch(e=>(e.message=`Request failed. Returned status of ${e.message} - sw-serveJSON()-catch`,JSON.stringify([])))}return DBHelper.debugObject("","sw-serveJSON()-2-fetch"),fetch(e,{headers:{"Content-Type":"application/json"}}).then(function(e){return e}).then(e=>e.json()).catch(e=>(e.message=`Request failed. Returned status of ${e.message} - sw-serveJSON`,e))}function getParameterByName(e,t){if(!t)return!1;e=e.replace(/[\[\]]/g,"\\$&");const s=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return s?s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):"":null}function cleanCache(){return caches.keys().then(function(e){return Promise.all(e.filter(function(e){return e.startsWith(appPrefix)&&!allCaches.includes(e)}).map(function(e){return caches.delete(e)}))}).catch(e=>{throw e.message=`Request failed clean cache. Returned status of ${e.message} -sw-cleanCache()`,e})}self.importScripts("js/idb.js"),self.importScripts("js/dbhelper.min.js"),debug=!0,DBHelper.debugObject("","start /sw.js"),self.addEventListener("install",function(e){DBHelper.debugObject("","sw-install()"),self.skipWaiting(),e.waitUntil(caches.open(DBHelper.staticCacheName).then(function(e){return DBHelper.debugObject("","sw-addEventListener()-install-1-staticCacheName.cache"),e.addAll(["/css/main.min.css","/js/regular.js","/js/fontawesome.js","/js/main.min.js","/js/dbhelper.min.js","/js/idb.js","/js/index.min.js","/js/restaurant.min.js","/404.html","/index.html","/manifest.json","/robots.txt","/sw.js","https://fonts.googleapis.com/css?family=Roboto","https://fonts.googleapis.com/css?family=Roboto:300,400,500,700","https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxK.woff2","https://fonts.gstatic.com/s/roboto/v18/KFOlCnqEu92Fr1MmEU9fBBc4.woff2"])}).then(e=>{DBHelper.debugObject(e,"sw-addEventListener()-install-2-result"),caches.open(DBHelper.contentImgsCache).then(function(e){return DBHelper.debugObject("","sw-addEventListener()-install-2-contentImgsCache.cache"),e.addAll(["/img/icons/icon.png","/img/icons/icon192.png","/img/icons/icon512.png","/img/320/1.jpg","/img/320/2.jpg","/img/320/3.jpg","/img/320/4.jpg","/img/320/5.jpg","/img/320/6.jpg","/img/320/7.jpg","/img/320/8.jpg","/img/320/9.jpg","/img/320/10.jpg","/img/placeholder.png"])}).then(e=>(DBHelper.debugObject(e,"sw-addEventListener()-install-3-result"),!0))}).catch(e=>{throw e.message=`Request failed. Returned status of ${e.message} - sw-install()`,e}))}),self.addEventListener("activate",function(e){DBHelper.debugObject("","sw-activate()"),e.waitUntil(cleanCache().catch(e=>(e.message=`Request failed. Returned status of ${e.message} - sw-activate()`,!1)))}),self.addEventListener("fetch",function(e){DBHelper.debugObject("","sw-addEventListener()-fetch()");const t=new URL(e.request.url);if(DBHelper.debugObject(t.url,"sw-addEventListener()-fetch-requestUrl.url"),DBHelper.debugObject(t.port,"sw-addEventListener()-fetch-requestUrl.port"),DBHelper.debugObject(t.pathname,"sw-addEventListener()-fetch-requestUrl.pathname"),DBHelper.debugObject(t.pathname.indexOf("img/")>0,"sw-addEventListener()-fetch-requestUrl.pathname.indexOf(img/) > 0"),"1337"===t.port){DBHelper.debugObject("","sw-addEventListener()-fetch-serveJSON()-call");const e=serveJSON(t);if(e)return e}else if(t.origin===location.origin){if(""===t.pathname||"/"===t.pathname){const t=caches.match("/index.html");return DBHelper.debugObject(!!t.then(e=>e),"sw-addEventListener()-cacheResponse"),void e.respondWith(caches.match("/index.html").catch(e=>(e.message=`Request failed serve request. Returned status of ${e.message} - sw-addEventListener()-fetch`,DBHelper.debugObject(e.message,"sw-addEventListener()-fetch-error.message"),DBHelper.debugObject("","sw-addEventListener()-fetch-404.html"),caches.match("/404.html"))))}if(t.pathname.indexOf("img/")>0)return DBHelper.debugObject("","sw-addEventListener()-fetch-respondWith-servePhoto()-call"),void e.respondWith(servePhoto(e.request))}DBHelper.debugObject("","sw-addEventListener()-fetch-respondWith-serveRequest()-call"),e.respondWith(serveRequest(e.request))});